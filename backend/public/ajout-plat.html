<!DOCTYPE html>
<html lang="fr">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ajouter un plat</title>
  <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body>

  <!-- Modal d'ajout de plat (admin) -->
  <div id="add-dish-modal" class="fixed inset-0 flex items-center justify-center z-50 bg-black bg-opacity-50 hidden">
    <div class="bg-white rounded-lg shadow-xl max-w-md w-full mx-4">
      <div class="p-6">
        <div class="flex justify-between items-center mb-4">
          <h3 class="text-xl font-bold">Ajouter un nouveau plat</h3>
          <button id="close-add-dish-modal" class="text-gray-500 hover:text-gray-700 text-xl">
            &times;
          </button>
        </div>

        <form id="add-dish-form" class="space-y-4">
          <div>
            <label for="dish-name" class="block text-gray-700 mb-2">Nom du plat</label>
            <input type="text" id="dish-name"
              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500"
              required />
          </div>

          <div>
            <label for="dish-description" class="block text-gray-700 mb-2">Description</label>
            <textarea id="dish-description" rows="3"
              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500"
              required></textarea>
          </div>

          <div>
            <label for="dish-price" class="block text-gray-700 mb-2">Prix (€)</label>
            <input type="number" id="dish-price" step="0.01" min="0"
              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500"
              required />
          </div>

          <div>
            <label for="dish-category" class="block text-gray-700 mb-2">Catégorie</label>
            <select id="dish-category"
              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500"
              required>
              <option value="">Sélectionnez une catégorie</option>
              <option value="starters">Entrées</option>
              <option value="mains">Plats Principaux</option>
              <option value="desserts">Desserts</option>
              <option value="drinks">Boissons</option>
            </select>
          </div>

          <div>
            <label for="dish-image" class="block text-gray-700 mb-2">URL de l'image</label>
            <input type="url" id="dish-image"
              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500"
              required />
          </div>

          <button type="submit"
            class="w-full bg-amber-500 hover:bg-amber-600 text-white font-bold py-3 px-4 rounded-lg transition duration-300">
            Ajouter le plat
          </button>
        </form>
      </div>
    </div>
  </div>

  <!-- Bouton pour afficher le modal -->
  <button onclick="openAddDishModal()"
    class="mt-4 px-6 py-3 bg-amber-500 text-white font-semibold rounded-lg hover:bg-amber-600">
    + Ajouter un plat
  </button>

  <!-- Script JavaScript -->
  <script>
    const addDishModal = document.getElementById("add-dish-modal");
    const closeAddDishModal = document.getElementById("close-add-dish-modal");

    function openAddDishModal() {
      addDishModal.classList.remove("hidden");
    }

    closeAddDishModal.addEventListener("click", () => {
      addDishModal.classList.add("hidden");
    });

    document.getElementById("add-dish-form").addEventListener("submit", async function (e) {
      e.preventDefault();

      const name = document.getElementById("dish-name").value.trim();
      const description = document.getElementById("dish-description").value.trim();
      const price = parseFloat(document.getElementById("dish-price").value);
      const category = document.getElementById("dish-category").value;
      const image = document.getElementById("dish-image").value.trim();
      const token = localStorage.getItem("token");

      if (!token) {
        alert("Vous devez être connecté.");
        return;
      }

      try {
        const response = await fetch("/api/dishes", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            Authorization: `Bearer ${token}`
          },
          body: JSON.stringify({ name, description, price, category, image })
        });

        if (response.ok) {
          alert("Plat ajouté avec succès !");
          addDishModal.classList.add("hidden");
          this.reset();
        } else {
          const err = await response.json();
          alert("Erreur : " + (err.message || "Impossible d'ajouter le plat."));
        }
      } catch (error) {
        alert("Erreur réseau : " + error.message);
      }
    });
  </script>

</body>

</html>
