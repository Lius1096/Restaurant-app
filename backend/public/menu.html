<!-- menu.html -->
<section id="menu" class="py-16 bg-gray-50">
  <div class="container mx-auto px-4">
    <div class="text-center mb-12">
      <h2 class="text-3xl font-bold text-gray-800 mb-4">Notre Carte</h2>
      <p class="text-gray-600 max-w-2xl mx-auto">
        Découvrez nos spécialités préparées avec des produits frais et de saison.
      </p>
    </div>

    <!-- Filtres par catégorie -->
    <div class="flex overflow-x-auto pb-2 mb-8 scrollbar-hide">
      <div class="flex space-x-1">
        <button class="tab-button px-4 py-2 whitespace-nowrap tab-active" data-category="all">Tous</button>
        <button class="tab-button px-4 py-2 whitespace-nowrap" data-category="starters">Entrées</button>
        <button class="tab-button px-4 py-2 whitespace-nowrap" data-category="mains">Plats Principaux</button>
        <button class="tab-button px-4 py-2 whitespace-nowrap" data-category="desserts">Desserts</button>
        <button class="tab-button px-4 py-2 whitespace-nowrap" data-category="drinks">Boissons</button>
      </div>
    </div>

    <!-- Liste des plats -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8" id="dishes-container">
      <div class="col-span-3 text-center py-8">
        <i class="fas fa-spinner fa-spin text-4xl text-amber-500 mb-4"></i>
        <p class="text-gray-600">Chargement des plats...</p>
      </div>
    </div>
  </div>
</section>

<!-- Script -->
<script>
  const API_BASE_URL = 'http://localhost:5000/api';
  let dishes = [];
  const dishesContainer = document.getElementById('dishes-container');

  async function fetchDishes() {
    try {
      const response = await fetch(`${API_BASE_URL}/dishes`);
      if (!response.ok) throw new Error('Erreur lors du chargement des plats');
      dishes = await response.json();
      renderDishes('all');
    } catch (error) {
      console.error('Error:', error);
      dishesContainer.innerHTML = `
        <div class="col-span-3 text-center py-8">
          <i class="fas fa-exclamation-triangle text-4xl text-red-500 mb-4"></i>
          <p class="text-gray-600">Erreur lors du chargement des plats</p>
          <button onclick="fetchDishes()" class="mt-4 bg-amber-500 hover:bg-amber-600 text-white font-bold py-2 px-4 rounded-lg transition duration-300">
            <i class="fas fa-sync-alt mr-2"></i> Réessayer
          </button>
        </div>
      `;
    }
  }

  function renderDishes(category) {
    dishesContainer.innerHTML = '';
    const filteredDishes = category === 'all' ? dishes : dishes.filter(d => d.category === category);

    if (filteredDishes.length === 0) {
      dishesContainer.innerHTML = `
        <div class="col-span-3 text-center py-8">
          <i class="fas fa-utensils text-4xl text-amber-500 mb-4"></i>
          <p class="text-gray-600">Aucun plat disponible dans cette catégorie</p>
        </div>
      `;
      return;
    }

    filteredDishes.forEach(dish => {
      const dishElement = document.createElement('div');
      dishElement.className = 'bg-white rounded-lg shadow-md overflow-hidden transition duration-300 hover:shadow-lg';
      dishElement.innerHTML = `
        <img src="${dish.image}" alt="${dish.name}" class="w-full h-48 object-cover">
        <div class="p-4">
          <h3 class="text-xl font-semibold mb-2">${dish.name}</h3>
          <p class="text-gray-600 mb-4">${dish.description}</p>
          <div class="flex justify-between items-center">
            <span class="text-lg font-bold text-amber-600">${dish.price.toFixed(2)} €</span>
            <button class="add-to-cart bg-amber-500 hover:bg-amber-600 text-white px-4 py-2 rounded-lg transition duration-300" data-id="${dish._id}">
              <i class="fas fa-plus"></i> Ajouter
            </button>
          </div>
        </div>
      `;
      dishesContainer.appendChild(dishElement);
    });

    // Ajouter événements
    document.querySelectorAll('.add-to-cart').forEach(button => {
      button.addEventListener('click', function () {
        const dishId = this.getAttribute('data-id');
        const dish = dishes.find(d => d._id === dishId);
        addToCart(dishId);
        showToast("Article ajouté", `${dish.name} a été ajouté à votre panier!`);
      });
    });
  }

  function addToCart(id) {
    // Simulation panier (à adapter avec localStorage ou backend)
    console.log("Ajouté au panier:", id);
  }

  function showToast(title, message) {
    const toast = document.createElement('div');
    toast.className = 'fixed top-5 right-5 bg-white border border-gray-300 shadow-md rounded-lg px-4 py-2 text-sm text-gray-800 z-50';
    toast.innerHTML = `<strong>${title}</strong><br>${message}`;
    document.body.appendChild(toast);
    setTimeout(() => toast.remove(), 3000);
  }

  // Gestion des filtres
  document.querySelectorAll('.tab-button').forEach(button => {
    button.addEventListener('click', () => {
      document.querySelectorAll('.tab-button').forEach(b => b.classList.remove('tab-active'));
      button.classList.add('tab-active');
      renderDishes(button.dataset.category);
    });
  });

  // Initialisation
  fetchDishes();
</script>
